{"version":3,"sources":["druki_content/assets/js/druki-content-toc.es6.js"],"names":["Drupal","behaviors","drukiContentTOC","attach","context","settings","trigger","window","requestIdleCallback","callback","toc","querySelector","processed","this","processTOC","element","links","querySelectorAll","attachEvents","processLinks","result","forEach","link","anchorId","getAttribute","substring","headingBounding","getElementById","getBoundingClientRect","push","top","addEventListener","throttle","event","linksWithPosition","closestLink","linkInfo","classList","remove","add"],"mappings":"CAKA,SAAWA,GAETA,EAAOC,UAAUC,gBAAkB,CACjCC,OAAQ,SAAUC,EAASC,GACzB,IAAIC,EAEFA,EADEC,OAAOC,oBACEC,IACTD,oBAAoBC,IAKXA,IACTA,KAIJH,GAAQ,KACN,IAAII,EAAMN,EAAQO,cAAc,sBAE5BD,IAAQA,EAAIE,YACdF,EAAIE,WAAY,EAChBC,KAAKC,WAAWV,EAASM,QAQ/BI,WAAY,SAAUV,EAASW,GAC7B,IAAIC,EAAQD,EAAQE,iBAAiB,4BACrCJ,KAAKK,aAAad,EAASY,IAM7BG,aAAc,SAAUf,EAASY,GAC/B,IAAII,EAAS,GAcb,OAZAJ,EAAMK,SAAQC,IACZ,IACIC,EADSD,EAAKE,aAAa,QACTC,UAAU,GAE5BC,EADmBtB,EAAQuB,eAAeJ,GACPK,wBAEvCR,EAAOS,KAAK,CACVP,KAAMA,EACNQ,IAAKJ,EAAgBI,SAIlBV,GAMTF,aAAc,SAAUd,EAASY,GAsB/BZ,EAAQ2B,iBAAiB,SAAU/B,EAAOgC,UArBrBC,IACnB,IAAIC,EAAoBrB,KAAKM,aAAaf,EAASY,GAC/CmB,EAAc,KAElBD,EAAkBb,SAAQe,IACxBA,EAASd,KAAKe,UAAUC,OAAO,mCAG3BF,EAASN,IAAM,KACjBK,EAAcC,EAASd,SAIvBa,GACFA,EAAYE,UAAUE,IAAI,qCAOqC,OAjFzE,CAqFGvC","file":"druki-content-toc.js","sourcesContent":["/**\n * @file\n * Druki Content TOC behaviors.\n */\n\n(function (Drupal) {\n\n  Drupal.behaviors.drukiContentTOC = {\n    attach: function (context, settings) {\n      let trigger;\n      if (window.requestIdleCallback) {\n        trigger = (callback) => {\n          requestIdleCallback(callback)\n        }\n      }\n      else {\n        // Fallback for browsers doesn't support IDLE callbacks.\n        trigger = (callback) => {\n          callback()\n        }\n      }\n\n      trigger(() => {\n        let toc = context.querySelector('.druki-content-toc');\n\n        if (toc && !toc.processed) {\n          toc.processed = true;\n          this.processTOC(context, toc);\n        }\n      });\n    },\n\n    /**\n     * Process TOC element.\n     */\n    processTOC: function (context, element) {\n      let links = element.querySelectorAll('.druki-content-toc__link');\n      this.attachEvents(context, links);\n    },\n\n    /**\n     * Find heading for link and it's position.\n     */\n    processLinks: function (context, links) {\n      let result = [];\n\n      links.forEach(link => {\n        let anchor = link.getAttribute('href');\n        let anchorId = anchor.substring(1);\n        let headingForAnchor = context.getElementById(anchorId);\n        let headingBounding = headingForAnchor.getBoundingClientRect();\n\n        result.push({\n          link: link,\n          top: headingBounding.top,\n        });\n      });\n\n      return result;\n    },\n\n    /**\n     * Attach all needed events.\n     */\n    attachEvents: function (context, links) {\n      let scrollListener = event => {\n        let linksWithPosition = this.processLinks(context, links);\n        let closestLink = null;\n\n        linksWithPosition.forEach(linkInfo => {\n          linkInfo.link.classList.remove('druki-content-toc__link--active');\n\n          // 24px is gap for activate link a bit earlier.\n          if (linkInfo.top < 24) {\n            closestLink = linkInfo.link;\n          }\n        });\n\n        if (closestLink) {\n          closestLink.classList.add('druki-content-toc__link--active');\n        }\n      };\n\n      // We throttle event for performance improvements. We don't need to\n      // execute this calculation on every scroll event. It's too redundant.\n      // 16ms is for 60fps smooth updates.\n      context.addEventListener('scroll', Drupal.throttle(scrollListener, 16));\n    },\n  };\n\n})(Drupal);\n"]}