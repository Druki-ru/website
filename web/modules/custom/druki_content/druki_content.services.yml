services:
  logger.channel.druki_content:
    class: Drupal\Core\Logger\LoggerChannel
    factory: logger.factory:get
    arguments: ['druki_content']

  druki_content.git_subscriber:
    class: Drupal\druki_content\EventSubscriber\GitSubscriber
    arguments: ['@druki_content.queue.content_sync_manager']
    tags:
      - { name: event_subscriber }

  druki_content.queue.content_sync_manager:
    class: Drupal\druki_content\Queue\ContentSyncQueueManager
    arguments:
      - '@druki_content.finder.content_source_file'
      - '@druki_content.finder.redirect_source_file'
      - '@queue'
      - '@state'
      - '@datetime.time'
      - '@plugin.manager.queue_worker'

  druki_content.finder.content_source_file:
    class: Drupal\druki_content\Finder\ContentSourceFileFinder
    arguments: ['@language_manager']

  druki_content.parser.content_source_file:
    class: Drupal\druki_content\Parser\ContentSourceFileParser
    arguments: ['@druki.markdown_parser']

  druki_content.queue.content_sync_processor:
    class: Drupal\druki_content\Queue\ContentSyncQueueProcessor
    arguments: ['@entity_type.manager', '@druki_content.parser.content_source_file', '@druki_content.parsed_source_content_loader', '@state', '@entity.memory_cache']
    tags:
      - { name: service_collector, tag: druki_sync_queue_processor, call: addProcessor }

  druki_content.sync_queue_processor.source_content_list:
    class: Drupal\druki_content\Sync\SourceContent\SourceContentListQueueProcessor
    public: false
    arguments: ['@state', '@druki_content.parser.content_source_file', '@druki_content.parsed_source_content_loader', '@logger.channel.druki_content']
    tags:
      - { name: druki_sync_queue_processor }

  druki_content.queue.clean_queue_processor:
    class: Drupal\druki_content\Queue\ContentSyncCleanQueueItemProcessor
    public: false
    arguments: ['@entity_type.manager']
    tags:
      - { name: druki_sync_queue_processor }

  druki_content.queue.redirect_queue_processor:
    class: Drupal\druki_content\Queue\ContentSyncRedirectQueueItemProcessor
    public: false
    arguments: ['@entity_type.manager', '@state']
    tags:
      - { name: druki_sync_queue_processor }

  druki_content.parsed_source_content_loader:
    class: Drupal\druki_content\Sync\SourceContent\ParsedSourceContentLoader
    arguments: ['@druki_content.parsed_content_loader', '@entity_type.manager', '@datetime.time']

  druki_content.parsed_content_loader:
    class: Drupal\druki_content\Sync\ParsedContent\ParsedContentLoader
    tags:
      - { name: service_collector, tag: druki_parsed_content_loader, call: addLoader }

  druki_content.parsed_content_loader.front_matter:
    class: Drupal\druki_content\Sync\ParsedContent\FrontMatter\FrontMatterLoader
    tags:
      - { name: druki_parsed_content_loader }

  druki_content.parsed_content_loader.paragraph_base:
    abstract: true
    class: Drupal\druki_content\Sync\ParsedContent\Content\ParagraphLoaderBase
    arguments: ['@entity_type.manager']

  druki_content.parsed_content_loader.paragraph_text:
    parent: druki_content.parsed_content_loader.paragraph_base
    class: Drupal\druki_content\Sync\ParsedContent\Content\ParagraphTextLoader
    tags:
      - { name: druki_parsed_content_loader }

  druki_content.parsed_content_loader.paragraph_heading:
    parent: druki_content.parsed_content_loader.paragraph_base
    class: Drupal\druki_content\Sync\ParsedContent\Content\ParagraphHeadingLoader
    tags:
      - { name: druki_parsed_content_loader }

  druki_content.parsed_content_loader.paragraph_code:
    parent: druki_content.parsed_content_loader.paragraph_base
    class: Drupal\druki_content\Sync\ParsedContent\Content\ParagraphCodeLoader
    tags:
      - { name: druki_parsed_content_loader }

  druki_content.parsed_content_loader.paragraph_note:
    parent: druki_content.parsed_content_loader.paragraph_base
    class: Drupal\druki_content\Sync\ParsedContent\Content\ParagraphNoteLoader
    tags:
      - { name: druki_parsed_content_loader }

  druki_content.parsed_content_loader.paragraph_image:
    parent: druki_content.parsed_content_loader.paragraph_base
    class: Drupal\druki_content\Sync\ParsedContent\Content\ParagraphImageLoader
    arguments: ['@druki_git.settings', '@druki.file_tracker', '@entity_field.manager', '@token', '@file_system']
    tags:
      - { name: druki_parsed_content_loader }

  druki_content.druki_content_route_context:
    class: Drupal\druki_content\ContextProvider\DrukiContentRouteContext
    arguments: ['@current_route_match']
    tags:
      - { name: context_provider }

  druki_content.finder.redirect_source_file:
    class: Drupal\druki_content\Finder\RedirectSourceFileFinder
    arguments: ['@language_manager']
